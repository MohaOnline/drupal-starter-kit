// Generated by CoffeeScript 1.6.3
/*
 @file
 Custom JS for administering WetKit Bean.
*/

/*
 JS to assist in managing the Bean Back End.
*/

(function($) {
  Drupal.behaviors.wetkitbeanAdmin = {
    attach: function(context, settings) {
      if (!$(context).hasClass("draggable")) {
          $("table#field-bean-slide-collection-values tr.draggable:not(.bean-slide-processed)", context).each(function() {
          var $form;
          $form = $(this).addClass("bean-slide-processed").find("> td:nth-child(2)");
          Drupal.wetkitbeanAdmin.setupForm($form);
          return $form.before(Drupal.wetkitbeanAdmin.createOverview($form));
        });
        return $("table#field-bean-slide-collection-values tr.draggable:last", context).each(function() {
          var $form;
          if (!$(this).hasClass("bean-slide-processed")) {
            $form = $(this).addClass("bean-slide-processed").find("> td:nth-child(2)");
            Drupal.wetkitbeanAdmin.setupForm($form);
            return $form.before(Drupal.wetkitbeanAdmin.createAdd($form));
          }
        });
      }
    }
  };
  Drupal.wetkitbeanAdmin = Drupal.wetkitbeanAdmin || {};
  Drupal.wetkitbeanAdmin.setupForm = function($form) {
    var $button;
    $form.addClass("slide-form").hide();
    $button = $("<div class=\"form-actions\"><input class=\"form-submit submit\" type=\"button\" value=\"Collapse\" /></div>").click(function() {
      $form.hide();
      Drupal.wetkitbeanAdmin.triggerChange();
      $form.before(Drupal.wetkitbeanAdmin.createOverview($form));
      return false;
    });
    return $form.append($button);
  };
  Drupal.wetkitbeanAdmin.createAdd = function($form) {
    var html;
    html = $(Drupal.theme("wetkitbeanNewOverview"));
    html.find("a.add").click(function() {
      $form.show();
      $(this).parents("td.overview").remove();
      return false;
    });
    return html;
  };
  Drupal.wetkitbeanAdmin.createOverview = function($form) {
    var html;
    html = $(Drupal.theme("wetkitbeanOverview", $form));
    html.find(".edit").click(function() {
      $form.show();
      $(this).parents("td.overview").remove();
      return false;
    });
    return html;
  };
  Drupal.wetkitbeanAdmin.triggerChange = function() {
    if (Drupal.tableDrag["field-bean-slide-collection-values"].changed === false) {
      $(Drupal.theme("tableDragChangedWarning")).insertBefore(Drupal.tableDrag["field-bean-slide-collection-values"].table).hide().fadeIn("slow");
      return Drupal.tableDrag["field-bean-slide-collection-values"].changed = true;
    }
  };
  Drupal.theme.prototype.wetkitbeanNewOverview = function() {
    return "<td class=\"overview\"><ul class=\"links\"><li><a class=\"add\" href=\"#\">New Slide</a></li></ul></td>";
  };
  return Drupal.theme.prototype.wetkitbeanOverview = function($form) {
    var html;
    html = "<td class=\"overview\"><div class=\"overview-column\">";
    if ($("div.media-thumbnail", $form).html()) {
      html += $("div.media-thumbnail", $form).html();
    }
    html += "</div><div class=\"overview-column headline\">";
    if ($(".field-name-field-slide-headline input", $form).val()) {
      html += $(".field-name-field-slide-headline input", $form).val();
    } else {
      html += "&nbsp;";
    }
    html += "</div>";
    html += "<div class=\"overview-column form-actions form-wrapper\"><input type=\"button\" class=\"form-submit edit\" value=\"Expand\" /></div>";
    html += "</td>";
    return html;
  };
})(jQuery);
